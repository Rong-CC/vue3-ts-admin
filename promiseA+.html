<!--
 * @Description: 
 * @Author: rongcheng
 * @@后台人员: xxx
 * @Date: 2021-04-13 11:04:54
 * @LastEditors: rongcheng
 * @LastEditTime: 2021-04-15 10:10:15
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromiseA+</title>
</head>
<body>
    
</body>
<script>
  const  PENDING = 'pending';
  const FULFILLED = 'fulfilled'
  const REJECTED = 'rejected'
  // 创建MyPromise 类
  class MyPromise {
    constructor (executor) {
      //executor 是一个执行器 进入会立即执行
      // 并传入resolve和reject方法
      executor(this.resolve,this.reject)
    }
    // 并传入resolve和reject方法
    status = PENDING
    //成功之后的值
    value = null
    //失败之后的值
    reason= null
    //  存储成功回调函数
    onFulfilledCallback = null
    // 存储失败回调函数
    onRejectedCallback = null
    // resolve和reject为什么要用箭头函数？
    // 如果直接调用的话，普通函数this指向的是window或者undefined
    // 用箭头函数就可以让this指向当前实例对象

    // 更改成功后的状态
    resolve = (value) => {
      if(this.status === PENDING) {
        // 状态修改为成功
        this.status = FULFILLED
        //保存成功之后的值
        this.value = value
      }
    }
    // 更改失败后的状态
    reject = (reason) => {
      if(this.status === PENDING){
         // 状态成功为失败
        this.status = REJECTED
        // 保存失败后的原因
        this.reason = reason  
      }
    }

    then (onFulfilled, onRejected){
      if(this.status === FULFILLED){
        // 调用成功回调，并且把值返回
        onFulfilled(this.value)
      }else if (this.status === REJECTED) {
       // 调用失败回调，并且把原因返回
       onRejected(this.reason);
      } else if(this.status === PENDING){
        // 因为不知道后面状态的变化情况，所以将成功回调和失败回调存储起来
        // 等到执行成功失败函数的时候再传递
        this.onFulfilledCallback = onFulfilled;
        this.onRejectedCallback = onRejected;
      }
    }
  }

  // module.exports = MyPromise
  const promise = new MyPromise((resolve, reject)=>{
    setTimeout(()=>{
      console.log('setTimeout');
      resolve('success')
    },2000)
  })
  promise.then(res => {
    console.log(res,'11');
  })
</script>
</html>